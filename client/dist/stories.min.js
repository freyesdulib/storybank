!function(){"use strict";angular.module("stories",[]).run(function($http,$templateCache){$http.get("stories/views/create-stories.client.view.html",{cache:$templateCache})}).run(function($http,$templateCache){$http.get("stories/views/edit-stories.client.view.html",{cache:$templateCache})}).run(function($http,$templateCache){$http.get("stories/views/list-stories.client.view.html",{cache:$templateCache})}).run(function($http,$templateCache){$http.get("stories/views/final-stories.client.view.html",{cache:$templateCache})}).run(function($http,$templateCache){$http.get("stories/views/stories.client.menu.view.html",{cache:$templateCache})}).run(function($http,$templateCache){$http.get("stories/views/draft-stories.client.view.html",{cache:$templateCache})})}(),function(){"use strict";var StoriesController=function($scope,$location,$routeParams,$filter,$timeout,Authentication,Stories,Tags,Flash,TagService){var vm=this;vm.authentication=Authentication,vm.isMobile=function(){var isMobile=!1;return screen.width<=540&&(isMobile=!0),isMobile};var successMessage=function(successMessage){$("form").hide();var message='<strong><span class="glyphicon glyphicon-ok">&nbsp;'+successMessage+"</span></strong>";Flash.create("success",message,"custom-class"),parent.scrollTo(0,0),$timeout(function(){$location.path("stories")},5e3)},strip_tags=function(input,allowed){var input=input.replace(/<br\s*[\/]?>/gi," ");allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,"").replace(tags,function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""})};vm.addTag=TagService.addTag,vm.removeTag=TagService.removeTag,vm.tags=TagService.tags,vm.addRelatedLink=TagService.addRelatedLink,vm.removeRelatedLink=TagService.removeRelatedLink,vm.relatedLinks=TagService.relatedLinks,vm.findTag=TagService.findTag,vm.getTags=function(){vm.tagList=Tags.query()},vm.truncate=function(story){return story.split(" ").length>79?story.substring(0,300):story},vm.storiesCreateFormInit=function(){var rlTmp,tTmp;rlTmp=TagService.relatedLinks=[],vm.relatedLinks=rlTmp,tTmp=TagService.tags=[],vm.tags=tTmp,vm.getTags()},vm.storiesEditFormInit=function(){var rlTmp,tTmp;rlTmp=TagService.relatedLinks=[],vm.relatedLinks=rlTmp,tTmp=TagService.tags=[],vm.tags=tTmp,vm.findOne(),vm.getTags()},vm.storiesRecordListInit=function(){vm.find()},vm.predicate="-created",vm.reverse=!1,vm.order=function(predicate){vm.reverse=vm.predicate===predicate?!vm.reverse:!1,vm.predicate=predicate},vm.create=function(){if(!$scope.storiesForm.$valid)return $scope.storiesForm.submitted=!0,!1;var story=new Stories({title:vm.title,story:strip_tags(vm.story,"<p></p><a></a>"),author:vm.author,status:vm.status,tags:vm.tags,relatedLinks:vm.relatedLinks});story.$save(function(){var message="Record added!";successMessage(message)},function(errorResponse){vm.error=errorResponse.data.message})},vm.find=function(){vm.story=Stories.query()},vm.findOne=function(){vm.story=Stories.get({storyId:$routeParams.storyId})},vm.update=function(){vm.story.$update(function(){var message="Record updated!";successMessage(message)},function(errorResponse){vm.error=errorResponse.data.message})},vm["delete"]=function(story){var confirm=window.confirm("Are you sure you want to delete this story?");confirm&&(story?story.$remove(function(){for(var i in vm.story)vm.story[i]===story&&vm.story.splice(i,1)}):vm.story.$remove(function(){var message="Record removed!";successMessage(message)}))}};StoriesController.$inject=["$scope","$location","$routeParams","$filter","$timeout","Authentication","Stories","Tags","Flash","TagService"],angular.module("stories").controller("StoriesController",StoriesController)}(),function(){"use strict";var resource=function($resource){return $resource("api/stories/:storyId",{storyId:"@_id"},{update:{method:"PUT"}})};angular.module("stories").factory("Stories",["$resource",resource])}(),function(){"use strict";var TagService=function(){var vm=this;vm.tags=[],vm.relatedLinks=[],vm.addTag=function(tag){var exists,tags=vm.tags;exists=vm.findTag(tag,tags),exists||vm.tags.push({name:tag})},vm.findTag=function(name,tagsArr){if(tagsArr.constructor!==Array||void 0===tagsArr)return!1;for(var i=0;i<tagsArr.length;i++)if(tagsArr[i].name===name)return!0},vm.removeTag=function(i){vm.tags.splice(i,1)},vm.addRelatedLink=function(){vm.relatedLinks.push({})},vm.removeRelatedLink=function(i){vm.relatedLinks.splice(i,1)}};angular.module("stories").service("TagService",[TagService])}(),function(){"use strict";var storiesMenu=function(){return{scope:{},restrict:"E",templateUrl:"stories/views/stories.client.menu.view.html"}};angular.module("stories").directive("storiesMenu",storiesMenu)}(),function(){"use strict";var tagList=function(){return{restrict:"E",controller:"StoriesController",controlerAs:"storiesController",templateUrl:"stories/views/tag-list.stories.client.view.html"}};angular.module("stories").directive("tagList",tagList)}(),function(){"use strict";var tags=function(){return{restrict:"E",controller:"StoriesController",controlerAs:"storiesController",templateUrl:"stories/views/tags.stories.client.view.html"}};angular.module("stories").directive("tags",tags)}(),function(){"use strict";var relatedLinks=function(){return{restrict:"E",controller:"StoriesController",controlerAs:"storiesController",templateUrl:"stories/views/related-links.stories.client.view.html"}};angular.module("stories").directive("relatedLinks",relatedLinks)}(),function(){"use strict";var storiesRoutes=function($routeProvider){var checkAuth={auth:function(){null===window.user&&(window.location="#!/signin")}};$routeProvider.when("/stories",{templateUrl:"stories/views/list-stories.client.view.html",resolve:checkAuth}).when("/stories/create",{templateUrl:"stories/views/create-stories.client.view.html",resolve:checkAuth}).when("/stories/:storyId",{templateUrl:"stories/views/view-stories.client.view.html",resolve:checkAuth}).when("/stories/create/:storyId",{templateUrl:"stories/views/create-stories.client.view.html",resolve:checkAuth}).when("/stories/:storyId/edit",{templateUrl:"stories/views/edit-stories.client.view.html",resolve:checkAuth}).when("/stories/:storyId/status/draft",{templateUrl:"stories/views/final-stories.client.view.html",resolve:checkAuth}).when("/stories/:storyId/status/final",{templateUrl:"stories/views/draft-stories.client.view.html",resolve:checkAuth}).otherwise({redirectTo:"/signin"})};angular.module("stories").config(["$routeProvider",storiesRoutes])}();